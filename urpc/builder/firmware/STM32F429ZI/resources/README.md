# Пример для микроконтроллера STM32F429ZI (USB)

Этот сгенерированный пример кода демонстрирует работу системы uRPC.
Микропрограмма написана для чипа STM32F429ZI. Предполагается, что
установлен внешний кварцевый резонатор на 8 МГц. Далее эта частота
преобразуется в частоту ядра 144 МГц.

Основной интерфейс USB используются PB12(ID), PB13(VBUS), PB14(DM), PB15(DP).
Для коммуникации настраивается интерфейс USART3 с параметрами 115200/8-N-1.
Ножки интерфейса Tx/PB10, Rx/PB11.

## Сборка проекта

Сборка делается в среде IAR 7.30. Копию дистрибутива можно скачать тут: https://download.urpc.kea.su/firmware/common/EWARM-CD-7303-8062.exe 

Для работы с периферией микропрограмма
использует библиотеку производителя STM32F4xx Low Layer APIs. Для удобства
код библиотеки собран в репозиторий на GitHub. Его следует скачать и разместить
на одном уровне с директорией данного примера.

1.	Разместить пример так, чтобы данный файл имел следующую вложенность
    **C:\projects\example\README.md**
    
2.  В директории  **C:\projects**  распаковать архив с проектом библиотеки. Если с помощью 7z, то правой кнопкой из меню выбрать распаковать здесь.    Путь к распакованной библиотеке будет иметь следующий вид **C:\projects\ST\stm32f4xx**.
    
3.	Архив можно скачать по ссылке: https://download.urpc.kea.su/firmware/stm32/f429zi/stm32f4xx.zip
    Если требуется история изменений, репозиторий библиотеки: https://github.com/Nikita-Presnov/stm32f4xx-ll-driver
    
4. 	Открыть в среде IAR рабочее окружение **C:\projects\example\workspace.eww**

5. 	В проекте driverlib проверить что в "Project->Options->C/C++ Compiler->Preprocessor" установлены правильные значения макроопределения "HSE_VALUE=8000000" и "HSE_STARTUP_TIMEOUT=1000"

6.  Используя пакетную сборку (клавиша <F8>) собрать библиотеку и микропрограмму

7.  Прошить микропрограмму в чип Project->Download and Debug (Ctrl + D)

## ВНИМАНИЕ! 

В целях минимизации использования библиотеки HAL, в прошивке используется макрос EPC_SIMPLIFIED_HAL_PCD 
для условной компиляции отредактированного файла stm32f4xx_hal_pcd.c. Для использования библиотеки HAL 
без изменений должны быть подключены файлы stm32f4xx_hal_rcc.c, stm32f4xx_hal_rcc_ex.c, stm32f4xx_hal_rcc.h;
макрос  EPC_SIMPLIFIED_HAL_PCD поставлен в 0.

## Изменение информации об устройстве

Имена устройства и производителя, серийный номер и идентификаторы VID и PID могут быть изменены в файле config.h.